$(function(){

    var Task = Backbone.Model.extend({
    	url : function() {
    		return this.id ? '/task/' + this.id : '/task';
    	}
    });

    var TaskCollection = Backbone.Collection.extend({
        model: Task,
        url: '/tasks'
    });
    var taskCollection = new TaskCollection();
    taskCollection.fetch({
    	success: function(){
    		alert("fetch all success");
    		var tasklistView = new TasklistView({ el: $("#tasklist_container") });
    	},
    	error: function(error){
    		alert("fetch all fail: " + error);
    	}
    });

	TasklistView = Backbone.View.extend({
		initialize: function(){
			this.render();
		},
		events: {
            "click input[type=button]": "addTask"
        },
        addTask: function( event ){
            // Button clicked, you can access the element that was clicked with event.currentTarget
            alert( "Create task " + $("#task_name").val() );
            var newTask = new Task({name:$("#task_name").val()});
            newTask.save();
       	},
		render: function(){
			// Compile the template using underscore
			alert("models: " + JSON.stringify(taskCollection.models));
			alert("name: " + taskCollection.models[0].name);
			var template = _.template( $("#tasklist_template").html(), { tasks: taskCollection.models, testarr: [1, 2, 3] } );
			this.el.html( template );
		}
	});
	
	
});